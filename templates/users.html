<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Users</title>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/default.css') }}">
</head>
<body>
  <div class="sidebar">
    <h2>CyberSeek</h2>
    <a href="{{ url_for('dashboard_monitoring') }}">> Monitoring</a>
    <a href="{{ url_for('reccon_whois') }}">> Reconnaissance</a>
    <a href="{{ url_for('analysis_reputation_lookup') }}">> Analysis</a>
    {% if role == 'admin' %}
      <a href="{{ url_for('dashboard_users') }}">> Users</a>
    {% endif %}
    <a href="{{ url_for('dashboard_password') }}">> Change password</a>
    <a href="{{ url_for('about') }}">> About</a>
    <a href="{{ url_for('logout') }}">Logout</a>
  </div>
  <div class="topbar">User Management</div>
  <div class="main">
    <div class="card">
      <h3>Registered Users</h3>

      {% if error %}
        <div style="margin-bottom: 1rem; padding: 10px; color: #a2243d; ">
          {{ error  | safe}}
        </div>
      {% endif %}
      {% if message %}
        <div style="margin-bottom: 1rem; padding: 10px; color: #02b8b2;">
          {{ message | safe }}
        </div>
      {% endif %}

      <table>
        <thead>
          <tr><th>Username</th><th>Role</th><th>Action</th></tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>{{ user.username | safe }}</td>
            <td>{{ user.role | safe}}</td>
            <td>
              <form method="post" action="{{ url_for('admin_panel') }}" class="inline" onsubmit="return confirm('Delete {{ user.username | safe}}?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="username" value="{{ user.username | safe }}">
                <button type="submit">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <hr style="margin: 2rem 0; border-color: #333;">

      <h3>Create New User</h3>
      <form method="post" action="{{ url_for('admin_panel') }}" style="margin-top: 1rem;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="action" value="create">
        <input type="text" name="new_username" placeholder="Username" required>
        <input type="password" name="new_password" placeholder="Password" required>

        <div style="margin-bottom: 10px;">
          <select name="role" required
                  style="padding: 8px; width: 100%; background: #111; border: 1px solid #444; color: #ccc;">
            <option value="">Select Role</option>
            <option value="admin">admin</option>
            <option value="user">user</option>
          </select>
        </div>
        <button type="submit">Create</button>
      </form>
    </div>
  </div>
</body>
</html>
